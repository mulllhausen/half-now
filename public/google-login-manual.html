<html>
  <body>
<button id="google">login with google</button><br><br>
      <script src="https://accounts.google.com/gsi/client" async defer></script>
      <script type="module">
document.getElementById('google').addEventListener('click', () => googleSignIn(), false);

// Import the functions you need from the SDKs you need
// Using browser modules is a quick way to get started, but we recommend using a
// module bundler for production.
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js';
import {
    getAuth,
    GoogleAuthProvider,
    getRedirectResult,
    onAuthStateChanged
} from 'https://www.gstatic.com/firebasejs/9.17.2/firebase-auth.js';

// For Firebase JS SDK v7.20.0 and later, measurementId is optional
// from https://console.firebase.google.com/project/half-now/settings/general/w
// safe to expose: stackoverflow.com/a/37484053
const firebaseConfig = {
  apiKey: "AIzaSyD1j1JxchDa4kCjIVxKPpZTFZDc9a084fw",
  authDomain: "half-now.firebaseapp.com",
  databaseURL: "https://half-now-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "half-now",
  storageBucket: "half-now.appspot.com",
  messagingSenderId: "1022216288188",
  appId: "1:1022216288188:web:fbf335e1f0918eb1345db9",
  measurementId: "G-04C5HYLHKH"
};
const firebase = initializeApp(firebaseConfig);
const auth = getAuth(firebase);



/*
 * Create form to request access token from Google's OAuth 2.0 server.
 */
function googleSignIn() {
  // Google's OAuth 2.0 endpoint for requesting an access token
  var oauth2Endpoint = 'https://accounts.google.com/o/oauth2/v2/auth';

  // Create <form> element to submit parameters to OAuth 2.0 endpoint.
  var form = document.createElement('form');
  form.setAttribute('method', 'GET'); // Send as a GET request.
  form.setAttribute('action', oauth2Endpoint);

  // Parameters to pass to OAuth 2.0 endpoint.
  var params = {
    client_id: "1022216288188-ujh6mc6dgivl9ghbfmiu6nobodnf5af6.apps.googleusercontent.com",
    redirect_uri: window.location.href,
    response_type: 'token',
    scope: 'https://www.googleapis.com/auth/drive.metadata.readonly',
    include_granted_scopes: 'true',
    state: 'pass-through value'
};

  // Add form parameters as hidden input values.
  for (var p in params) {
    var input = document.createElement('input');
    input.setAttribute('type', 'hidden');
    input.setAttribute('name', p);
    input.setAttribute('value', params[p]);
    form.appendChild(input);
  }

  // Add form to page and submit it to open the OAuth 2.0 endpoint.
  document.body.appendChild(form);
  form.submit();
}
        // from https://firebase.google.com/docs/auth/web/google-signin#expandable-2
        function handleCredentialResponse(response) {
          // Build Firebase credential with the Google ID token.
          console.log("Encoded JWT ID token: " + response.credential);
          const idToken = response.credential;
          const credential = GoogleAuthProvider.credential(idToken);

          // Sign in with credential from the Google user.
          signInWithCredential(auth, credential).catch((error) => {
            // Handle Errors here.
            const errorCode = error.code;
            const errorMessage = error.message;
            // The email of the user's account used.
            const email = error.email;
            // The credential that was used.
            const credential = GoogleAuthProvider.credentialFromError(error);
            // ...
          });
        }
        // from https://developers.google.com/identity/gsi/web/guides/display-button#javascript
        /*window.addEventListener('load', () => {
          google.accounts.id.initialize({
            client_id: "1022216288188-ujh6mc6dgivl9ghbfmiu6nobodnf5af6.apps.googleusercontent.com",
            callback: handleCredentialResponse
          });
          google.accounts.id.renderButton(
            document.getElementById("buttonDiv"),
            { theme: "outline", size: "large" }  // customization attributes
          );
          google.accounts.id.prompt(); // also display the One Tap dialog
        });*/
    </script>
    <div id="buttonDiv"></div> 
  </body>
</html>
